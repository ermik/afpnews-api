!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AfpNews=t():e.AfpNews=t()}(global,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=12)}([function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/core-js/object/assign")},function(e,t){e.exports=require("btoa")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.defaultSearchParams={lang:null,urgency:null,searchTerms:null,size:10,dateFrom:"now-1h",dateTo:"now",sort:"published desc"}},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("form-data")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.post=t.get=void 0;var n,u,a=p(r(3)),s=p(r(2)),o=p(r(1)),i=p(r(0)),c=(t.get=(n=(0,i.default)(s.default.mark(function e(t,r){var n,u=r.params,a=r.headers;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.default)({method:"get",url:t,params:u,headers:a});case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",o.default.reject(e.t0));case 10:case"end":return e.stop()}},e,this,[[0,7]])})),function(e,t){return n.apply(this,arguments)}),t.post=(u=(0,i.default)(s.default.mark(function e(t){var r,n,u,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},p=arguments[2],l=p.formData,h=p.headers;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,l){for(n in r=new c.default,l)r.append(n,l[n]);i=(0,a.default)(i,r),"function"==typeof r.getHeaders&&(h=(0,a.default)({},h,r.getHeaders()))}return e.next=4,(0,f.default)({method:"post",url:t,data:i,headers:h});case 4:return u=e.sent,e.abrupt("return",u.data);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",o.default.reject(e.t0));case 11:case"end":return e.stop()}},e,this,[[0,8]])})),function(e){return u.apply(this,arguments)}),p(r(7))),f=p(r(6));function p(e){return e&&e.__esModule?e:{default:e}}},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("babel-runtime/helpers/createClass")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=h(r(3)),u=h(r(2)),a=h(r(1)),s=h(r(0)),o=h(r(11)),i=h(r(10)),c=r(9),f=r(8),p=r(5),l=h(r(4));function h(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.apiKey,n=t.clientId,u=t.clientSecret,a=t.baseUrl;(0,o.default)(this,e),this.apiKey={apiKey:r,clientId:n,clientSecret:u},this.baseUrl=a||"https://api.afp.com",this.resetToken()}return(0,i.default)(e,[{key:"authenticate",value:function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.apiKey){e.next=16;break}if(!t){e.next=5;break}return e.abrupt("return",this.requestAuthenticatedToken(t));case 5:if(null!==this.token){e.next=9;break}throw new Error("You need to authenticate with credentials once");case 9:if(!1!==this.isTokenValid){e.next=13;break}return e.abrupt("return",this.requestRefreshToken());case 13:return e.abrupt("return",a.default.resolve(this.token));case 14:e.next=21;break;case 16:if(!t){e.next=20;break}throw new Error("You need an api key to make authenticated requests");case 20:return e.abrupt("return",this.requestAnonymousToken());case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"requestAnonymousToken",value:function(){var e=(0,s.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.get)(this.authUrl,{params:{grant_type:"anonymous"},json:!0});case 3:return t=e.sent,e.abrupt("return",this.parseToken(t));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",a.default.reject(e.t0));case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"requestAuthenticatedToken",value:function(){var e=(0,s.default)(u.default.mark(function e(t){var r,n=t.username,s=t.password;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.post)(this.authUrl,{},{formData:{username:n,password:s,grant_type:"password"},headers:{Authorization:"Basic "+this.apiKey},json:!0});case 3:return r=e.sent,e.abrupt("return",this.parseToken(r));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",a.default.reject(e.t0));case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(t){return e.apply(this,arguments)}}()},{key:"requestRefreshToken",value:function(){var e=(0,s.default)(u.default.mark(function e(){var t;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.post)(this.authUrl,{},{formData:{refresh_token:this.token.refreshToken,grant_type:"refresh_token"},headers:{Authorization:"Basic "+this.apiKey}});case 3:return t=e.sent,e.abrupt("return",this.parseToken(t));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",a.default.reject(e.t0));case 10:case"end":return e.stop()}},e,this,[[0,7]])}));return function(){return e.apply(this,arguments)}}()},{key:"parseToken",value:function(e){var t=e.access_token,r=e.refresh_token,n=e.expires_in;return this.token={accessToken:t,refreshToken:r,tokenExpires:+new Date+1e3*n},a.default.resolve(this.token)}},{key:"resetToken",value:function(){this.token={accessToken:null,refreshToken:null,tokenExpires:null}}},{key:"search",value:function(){var e=(0,s.default)(u.default.mark(function e(t){var r,s,o,i,c,p,l,h,d,k,v,y,F,b,x,m;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,n.default)({},this.defaultSearchParams,t),s=r.size,o=r.dateFrom,i=r.dateTo,c=r.urgency,p=r.searchTerms,l=r.lang,h=r.sort,e.next=3,this.authenticate();case 3:return d=["product:news","product:multimedia","product:photo","product:sid"],k=[],c&&d.push("urgency:"+c),"string"==typeof p&&(""===p?p=null:(v=/(["']((?:[\0-!#-&\(-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)["'])|((?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)/g,p=p.match(v))),Array.isArray(p)&&(k=p.map(function(e){return e.split(":")[1]?e:"*:"+e})),y={lang:l,size:s,sort:h,from:o,to:i,fq:d.join(","),q:k.join(",")},e.prev=9,e.next=12,(0,f.post)(this.searchUrl,{},{body:y,headers:{Authorization:"Bearer "+this.token.accessToken,"Content-Type":"application/json"}});case 12:return F=e.sent,b=F.response,x=b.docs,m=b.numFound,e.abrupt("return",a.default.resolve({documents:x||[],count:m}));case 17:return e.prev=17,e.t0=e.catch(9),e.abrupt("return",a.default.reject(e.t0));case 20:case"end":return e.stop()}},e,this,[[9,17]])}));return function(t){return e.apply(this,arguments)}}()},{key:"authUrl",get:function(){return(0,c.resolve)(this.baseUrl,"/oauth/token")}},{key:"apiKey",get:function(){return this._apiKey},set:function(e){var t=e.apiKey,r=e.clientId,n=e.clientSecret;this._apiKey=r&&n?(0,l.default)(r+":"+n):t}},{key:"isTokenValid",get:function(){return this.token&&this.token.tokenExpires>+new Date}},{key:"token",get:function(){return null===this._accessToken||null===this._tokenExpires||null===this._refreshToken?null:{accessToken:this._accessToken,tokenExpires:this._tokenExpires,refreshToken:this._refreshToken}},set:function(e){var t=e.accessToken,r=e.refreshToken,n=e.tokenExpires;this._accessToken=t,this._refreshToken=r,this._tokenExpires=n}},{key:"searchUrl",get:function(){return(0,c.resolve)(this.baseUrl,"/v1/api/search")}},{key:"defaultSearchParams",get:function(){return p.defaultSearchParams}}]),e}();t.default=d}]).default});