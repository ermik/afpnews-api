!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AfpNews=t():e.AfpNews=t()}(global,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/toConsumableArray")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t){e.exports=require("@babel/runtime/helpers/typeof")},function(e,t){e.exports=require("form-data")},function(e,t){e.exports=require("lucene-query-parser")},function(e,t){e.exports=require("btoa")},function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),s=r(1),o=r.n(s),i=r(5),u=r.n(i),c=r(6),p=r.n(c),h=r(4),f=r(7),l=r.n(f),d=r(8),k=r.n(d),y=r(3),v=r.n(y);function m(e,t){return b.apply(this,arguments)}function b(){return(b=o()(a.a.mark(function e(t,r){var n,s,o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params,s=r.headers,e.prev=1,e.next=4,v()({method:"get",url:t,params:n,headers:s});case 4:return o=e.sent,e.abrupt("return",o.data);case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 11:case"end":return e.stop()}},e,this,[[1,8]])}))).apply(this,arguments)}function x(e){return T.apply(this,arguments)}function T(){return(T=o()(a.a.mark(function e(t){var r,n,s,o,i,u,c,p,h=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:{},n=h.length>2?h[2]:void 0,s=n.formData,o=n.headers,e.prev=2,"object"!==l()(s)){e.next=13;break}for(u in i=new k.a,s)i.append(u,s[u]);return"function"==typeof i.getHeaders&&(o=Object.assign({},o,i.getHeaders())),e.next=9,v.a.post(t,i,{headers:o});case 9:return c=e.sent,e.abrupt("return",c.data);case 13:return e.next=15,v.a.post(t,r,{headers:o});case 15:return p=e.sent,e.abrupt("return",p.data);case 17:e.next=22;break;case 19:return e.prev=19,e.t0=e.catch(2),e.abrupt("return",Promise.reject(e.t0));case 22:case"end":return e.stop()}},e,this,[[2,19]])}))).apply(this,arguments)}var g={products:["news","multimedia","photo","infographie","sid","videographie","livereport","sidtv","parismode"],langs:["fr","en","es","de","pt","ar","zh-tw","zh-cn"],urgencies:[1,2,3,4,5],query:"",size:10,dateFrom:"2012-01-01",dateTo:"now",sortField:"published",sortOrder:"desc"},w=r(2),_=r.n(w),j=r(9);function q(e){if("string"!=typeof e)throw"The query must be a string";return e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function P(e){return""===e?[]:function e(t){if("<implicit>"===t.operator)return _()(e(t.left)).concat(_()(e(t.right)));if("AND"===t.operator)return[{and:_()(e(t.left)).concat(_()(e(t.right)))}];if("OR"===t.operator)return[{or:_()(e(t.left)).concat(_()(e(t.right)))}];if(!t.operator){if(t.left)return _()(e(t.left));var r={name:"<implicit>"===t.field?"news":q(t.field)};return"-"===t.prefix?r.exclude=[q(t.term)]:r.in=[q(t.term)],[r]}}(Object(j.parse)(e))}var O=r(10),E=r.n(O);r.d(t,"default",function(){return K});var K=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.apiKey,n=t.clientId,a=t.clientSecret,s=t.baseUrl;u()(this,e),this.apiKey={apiKey:r,clientId:n,clientSecret:a},this.baseUrl=s||"https://api.afp.com",this.resetToken()}return p()(e,[{key:"authenticate",value:function(){var e=o()(a.a.mark(function e(){var t,r,n,s=arguments;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},r=t.username,n=t.password,!this.apiKey){e.next=17;break}if(!r||!n){e.next=6;break}return e.abrupt("return",this.requestAuthenticatedToken({username:r,password:n}));case 6:if(null!==this.token){e.next=10;break}throw new Error("You need to authenticate with credentials once");case 10:if(!1!==this.isTokenValid){e.next=14;break}return e.abrupt("return",this.requestRefreshToken());case 14:return e.abrupt("return",Promise.resolve(this.token));case 15:e.next=22;break;case 17:if(!r||!n){e.next=21;break}throw new Error("You need an api key to make authenticated requests");case 21:return e.abrupt("return",this.requestAnonymousToken());case 22:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"requestAnonymousToken",value:function(){var e=o()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(this.authUrl,{params:{grant_type:"anonymous"},json:!0});case 3:return(t=e.sent).authType="anonymous",e.abrupt("return",this.parseToken(t));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"requestAuthenticatedToken",value:function(){var e=o()(a.a.mark(function e(t){var r,n,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.username,n=t.password,e.prev=1,e.next=4,x(this.authUrl,{},{formData:{username:r,password:n,grant_type:"password"},headers:this.authorizationBasicHeaders,json:!0});case 4:return(s=e.sent).authType="credentials",e.abrupt("return",this.parseToken(s));case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"requestRefreshToken",value:function(){var e=o()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x(this.authUrl,{},{formData:{refresh_token:this.token.refreshToken,grant_type:"refresh_token"},headers:this.authorizationBasicHeaders});case 3:return(t=e.sent).authType=this.token.authType,e.abrupt("return",this.parseToken(t));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"parseToken",value:function(e){var t=e.access_token,r=e.refresh_token,n=e.expires_in,a=e.authType;return this.token={accessToken:t,refreshToken:r,tokenExpires:+new Date+1e3*n,authType:a},Promise.resolve(this.token)}},{key:"resetToken",value:function(){delete this._accessToken,delete this._refreshToken,delete this._tokenExpires,delete this._authType}},{key:"search",value:function(){var e=o()(a.a.mark(function e(t){var r,n,s,o,i,u,c,p,h,f,l,d,k,y,v,m,b;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({},this.defaultSearchParams,t),n=r.products,s=r.size,o=r.dateFrom,i=r.dateTo,u=r.urgencies,c=r.query,p=r.langs,h=r.sortField,f=r.sortOrder,e.next=3,this.authenticate();case 3:(l={and:[]}).and.push({name:"lang",in:p}),l.and.push({name:"product",in:n}),l.and.push({name:"urgency",in:u}),e.prev=7,d=P(c),l.and=l.and.concat(d),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(7),e.abrupt("return",Promise.reject(new Error("Invalid request")));case 15:return k={maxRows:s,sortField:h,sortOrder:f,dateRange:{from:o,to:i},query:l},e.prev=16,e.next=19,x(this.searchUrl,k,{headers:{Authorization:"Bearer ".concat(this.token.accessToken),"Content-Type":"application/json"}});case 19:return y=e.sent,v=y.response,m=v.docs,b=v.numFound,e.abrupt("return",Promise.resolve({documents:m||[],count:b}));case 24:return e.prev=24,e.t1=e.catch(16),e.abrupt("return",Promise.reject(e.t1));case 27:case"end":return e.stop()}},e,this,[[7,12],[16,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"authUrl",get:function(){return Object(h.resolve)(this.baseUrl,"/oauth/token")}},{key:"apiKey",get:function(){return this._apiKey},set:function(e){var t=e.apiKey,r=e.clientId,n=e.clientSecret;r&&n?this._apiKey=E()("".concat(r,":").concat(n)):t?this._apiKey=t:delete this._apiKey}},{key:"isTokenValid",get:function(){return this.token&&this.token.tokenExpires>+new Date}},{key:"token",get:function(){return void 0===this._accessToken||void 0===this._tokenExpires||void 0===!this._refreshToken||void 0===this._authType?null:{accessToken:this._accessToken,tokenExpires:this._tokenExpires,refreshToken:this._refreshToken,authType:this._authType}},set:function(e){var t=e.accessToken,r=e.refreshToken,n=e.tokenExpires,a=e.authType;this._accessToken=t,this._refreshToken=r,this._tokenExpires=n,this._authType=a}},{key:"authorizationBasicHeaders",get:function(){return{Authorization:"Basic ".concat(this.apiKey)}}},{key:"searchUrl",get:function(){return Object(h.resolve)(this.baseUrl,"/v1/api/search")}},{key:"defaultSearchParams",get:function(){return g}}]),e}()}]).default});